{"version":3,"file":"lib.js","sources":["../../src/api/legendSets.js","../../src/api/organisationUnits.js","../../src/assets/ArrowUpwardIcon.js","../../src/assets/ArrowDownwardIcon.js","../../src/ContextualMenu.js","../../src/ChartPlugin.js","../../src/PivotPlugin.js","../../src/api/analytics.js","../../src/modules/analytics.js","../../src/modules/options.js","../../src/modules/getRequestOptions.js","../../src/modules/fetchData.js","../../src/styles/VisualizationPlugin.style.js","../../src/VisualizationPlugin.js"],"sourcesContent":["const legendSetsQuery = {\n    legendSets: {\n        resource: 'legendSets',\n        params: ({ ids }) => ({\n            fields:\n                'id,legends[id,displayName~rename(name),startValue,endValue,color]',\n            filter: `id:in:[${ids.join(',')}]`,\n        }),\n    },\n}\n\nexport const apiFetchLegendSets = (dataEngine, ids) =>\n    dataEngine.query(legendSetsQuery, { variables: { ids } })\n","export const orgUnitLevelsQuery = {\n    orgUnitLevels: {\n        resource: 'organisationUnitLevels',\n        params: {\n            fields: 'id,level,displayName~rename(name)',\n            paging: 'false',\n        },\n    },\n}\n\nconst orgUnitsQuery = {\n    orgUnits: {\n        resource: 'organisationUnits',\n        id: ({ id }) => id,\n        params: {\n            fields:\n                'id,level,displayName~rename(name),path,parent[id,displayName~rename(name)],children[level]',\n            paging: 'false',\n            userDataViewFallback: 'true',\n        },\n    },\n}\n\nexport const apiFetchOrganisationUnitLevels = dataEngine =>\n    dataEngine.query(orgUnitLevelsQuery)\n\nexport const apiFetchOrganisationUnit = (dataEngine, id) =>\n    dataEngine.query(orgUnitsQuery, { variables: { id } })\n","import React from 'react'\nimport PropTypes from 'prop-types'\n\nconst ArrowUpwardIcon = ({ style = { width: 18, height: 18 } }) => (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" style={style}>\n        <path d=\"M0 0h24v24H0V0z\" fill=\"none\" />\n        <path\n            d=\"M4 12l1.41 1.41L11 7.83V20h2V7.83l5.58 5.59L20 12l-8-8-8 8z\"\n            fill=\"black\"\n        />\n    </svg>\n)\n\nArrowUpwardIcon.propTypes = {\n    style: PropTypes.object,\n}\n\nexport default ArrowUpwardIcon\n","import React from 'react'\nimport PropTypes from 'prop-types'\n\nconst ArrowDownwardIcon = ({ style = { width: 18, height: 18 } }) => (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" style={style}>\n        <path d=\"M0 0h24v24H0V0z\" fill=\"none\" />\n        <path\n            d=\"M20 12l-1.41-1.41L13 16.17V4h-2v12.17l-5.58-5.59L4 12l8 8 8-8z\"\n            fill=\"black\"\n        />\n    </svg>\n)\n\nArrowDownwardIcon.propTypes = {\n    style: PropTypes.object,\n}\n\nexport default ArrowDownwardIcon\n","import React, { useEffect, useState, useCallback } from 'react'\nimport PropTypes from 'prop-types'\n\nimport i18n from '@dhis2/d2-i18n'\nimport { useDataEngine } from '@dhis2/app-runtime'\nimport { Divider, Menu, MenuItem } from '@dhis2/ui-core'\n\nimport ArrowUpwardIcon from './assets/ArrowUpwardIcon'\nimport ArrowDownwardIcon from './assets/ArrowDownwardIcon'\n\nimport { apiFetchOrganisationUnit } from './api/organisationUnits'\n\nexport const ContextualMenu = ({ config, ouLevels, onClick }) => {\n    const engine = useDataEngine()\n    const [ouData, setOuData] = useState(undefined)\n    const [subLevelData, setSubLevelData] = useState(undefined)\n\n    const lookupLevel = levelId => ouLevels.find(item => item.level === levelId)\n\n    const doFetchOuData = useCallback(\n        async ouId => {\n            const ouData = await apiFetchOrganisationUnit(engine, ouId)\n\n            return ouData.orgUnits\n        },\n        [engine]\n    )\n\n    useEffect(() => {\n        setOuData(null)\n\n        const doFetch = async () => {\n            const orgUnit = await doFetchOuData(config.ouId)\n\n            setOuData(orgUnit)\n        }\n\n        if (config.ouId) {\n            doFetch()\n        }\n\n        /* eslint-disable-next-line react-hooks/exhaustive-deps */\n    }, [config])\n\n    useEffect(() => {\n        setSubLevelData(null)\n\n        if (ouData?.children.length) {\n            const levelData = lookupLevel(ouData.children[0].level)\n\n            if (levelData) {\n                setSubLevelData(levelData)\n            }\n        }\n\n        /* eslint-disable-next-line react-hooks/exhaustive-deps */\n    }, [ouData])\n\n    const menuItemStyle = {\n        display: 'inline-block',\n        minWidth: 200,\n    }\n\n    return (\n        <Menu>\n            {ouData && (\n                <MenuItem dense label={i18n.t('Change org unit')}>\n                    <Menu>\n                        {ouData?.parent && (\n                            <>\n                                <MenuItem\n                                    dense\n                                    icon={<ArrowUpwardIcon />}\n                                    label={\n                                        <span style={menuItemStyle}>\n                                            {ouData.parent.name}\n                                        </span>\n                                    }\n                                    onClick={() =>\n                                        onClick({\n                                            ou: { id: ouData.parent.id },\n                                        })\n                                    }\n                                />\n                                {subLevelData && <Divider />}\n                            </>\n                        )}\n                        {subLevelData && (\n                            <MenuItem\n                                dense\n                                icon={<ArrowDownwardIcon />}\n                                label={\n                                    <span style={menuItemStyle}>\n                                        {i18n.t(\n                                            '{{level}} level in {{orgunit}}',\n                                            {\n                                                level: subLevelData.name,\n                                                orgunit: ouData.name,\n                                            }\n                                        )}\n                                    </span>\n                                }\n                                onClick={() =>\n                                    onClick({\n                                        ou: {\n                                            id: ouData.id,\n                                            path: ouData.path,\n                                            level: subLevelData.id,\n                                        },\n                                    })\n                                }\n                            />\n                        )}\n                    </Menu>\n                </MenuItem>\n            )}\n        </Menu>\n    )\n}\n\nContextualMenu.propTypes = {\n    config: PropTypes.object,\n    ouLevels: PropTypes.array,\n    onClick: PropTypes.func,\n}\n\nexport default ContextualMenu\n","import React, { useRef, useCallback, useEffect } from 'react'\nimport PropTypes from 'prop-types'\nimport { isSingleValue, createVisualization } from '@dhis2/analytics'\n\nconst ChartPlugin = ({\n    visualization,\n    responses,\n    extraOptions,\n    legendSets,\n    id: renderCounter,\n    style,\n    onChartGenerated,\n    animation: defaultAnimation,\n}) => {\n    const canvasRef = useRef(undefined)\n\n    const renderVisualization = useCallback(\n        animation => {\n            const visualizationConfig = createVisualization(\n                responses,\n                visualization,\n                canvasRef.current,\n                {\n                    ...extraOptions,\n                    animation,\n                    legendSets,\n                },\n                undefined,\n                undefined,\n                isSingleValue(visualization.type) ? 'dhis' : 'highcharts' // output format\n            )\n\n            if (isSingleValue(visualization.type)) {\n                onChartGenerated(visualizationConfig.visualization)\n            } else {\n                onChartGenerated(\n                    visualizationConfig.visualization.getSVGForExport({\n                        sourceHeight: 768,\n                        sourceWidth: 1024,\n                    })\n                )\n            }\n        },\n        [\n            canvasRef,\n            visualization,\n            onChartGenerated,\n            responses,\n            extraOptions,\n            legendSets,\n        ]\n    )\n\n    useEffect(() => {\n        renderVisualization(defaultAnimation)\n\n        /* eslint-disable-next-line react-hooks/exhaustive-deps */\n    }, [visualization, responses, extraOptions])\n\n    useEffect(() => {\n        renderVisualization(0)\n\n        /* eslint-disable-next-line react-hooks/exhaustive-deps */\n    }, [renderCounter, style])\n\n    return <div ref={canvasRef} style={style} />\n}\n\nChartPlugin.defaultProps = {\n    visualization: {},\n    filters: {},\n    style: {},\n    animation: 200,\n    onChartGenerated: Function.prototype,\n}\n\nChartPlugin.propTypes = {\n    extraOptions: PropTypes.object.isRequired,\n    legendSets: PropTypes.arrayOf(PropTypes.object).isRequired,\n    responses: PropTypes.arrayOf(PropTypes.object).isRequired,\n    visualization: PropTypes.object.isRequired,\n    animation: PropTypes.number,\n    id: PropTypes.number,\n    style: PropTypes.object,\n    onChartGenerated: PropTypes.func,\n}\n\nexport default ChartPlugin\n","import React from 'react'\nimport PropTypes from 'prop-types'\n\nimport { PivotTable } from '@dhis2/analytics'\n\nconst PivotPlugin = ({\n    responses,\n    legendSets,\n    visualization,\n    style,\n    id: renderCounter,\n    onToggleContextualMenu,\n}) => {\n    return (\n        <div style={style}>\n            <PivotTable\n                visualization={visualization}\n                data={responses[0].response}\n                legendSets={legendSets}\n                renderCounter={renderCounter}\n                onToggleContextualMenu={onToggleContextualMenu}\n            />\n        </div>\n    )\n}\n\nPivotPlugin.defaultProps = {\n    style: {},\n}\n\nPivotPlugin.propTypes = {\n    legendSets: PropTypes.arrayOf(PropTypes.object).isRequired,\n    responses: PropTypes.arrayOf(PropTypes.object).isRequired,\n    visualization: PropTypes.object.isRequired,\n    id: PropTypes.number,\n    style: PropTypes.object,\n    onToggleContextualMenu: PropTypes.func,\n}\n\nexport default PivotPlugin\n","import { VIS_TYPE_PIVOT_TABLE } from '@dhis2/analytics'\n\nconst peId = 'pe'\n\nexport const apiFetchAnalytics = async (d2, current, options) => {\n    const req = new d2.analytics.request()\n        .fromModel(current)\n        .withParameters(options)\n        .withIncludeNumDen(current.type === VIS_TYPE_PIVOT_TABLE)\n\n    const rawResponse = await d2.analytics.aggregate.get(req)\n\n    return [new d2.analytics.response(rawResponse)]\n}\n\nexport const apiFetchAnalyticsForYearOverYear = async (\n    d2,\n    current,\n    options\n) => {\n    let yearlySeriesReq = new d2.analytics.request()\n        .addPeriodDimension(current.yearlySeries)\n        .withSkipData(true)\n        .withSkipMeta(false)\n        .withIncludeMetadataDetails(true)\n\n    if (options.relativePeriodDate) {\n        yearlySeriesReq = yearlySeriesReq.withRelativePeriodDate(\n            options.relativePeriodDate\n        )\n    }\n\n    const yearlySeriesRes = await d2.analytics.aggregate.fetch(yearlySeriesReq)\n\n    const requests = []\n    const yearlySeriesLabels = []\n\n    const now = new Date()\n    const currentDay = ('' + now.getDate()).padStart(2, 0)\n    const currentMonth = ('' + (now.getMonth() + 1)).padStart(2, 0)\n\n    yearlySeriesRes.metaData.dimensions[peId].forEach(period => {\n        yearlySeriesLabels.push(yearlySeriesRes.metaData.items[period].name)\n\n        const startDate = `${period}-${currentMonth}-${currentDay}`\n\n        const req = new d2.analytics.request()\n            .fromModel(current)\n            .withParameters(options)\n            .withRelativePeriodDate(startDate)\n\n        requests.push(d2.analytics.aggregate.get(req))\n    })\n\n    return Promise.all(requests).then(responses => ({\n        responses: responses.map(res => new d2.analytics.response(res)),\n        yearlySeriesLabels,\n    }))\n}\n","export const computeGenericPeriodNames = responses => {\n    const xAxisRes = responses.reduce((out, res) => {\n        if (out.metaData) {\n            if (\n                res.metaData.dimensions.pe.length >\n                out.metaData.dimensions.pe.length\n            ) {\n                out = res\n            }\n        } else {\n            out = res\n        }\n\n        return out\n    }, {})\n\n    const metadata = xAxisRes.metaData\n\n    return metadata.dimensions.pe.reduce((genericPeriodNames, periodId) => {\n        const name = metadata.items[periodId].name\n\n        // until the day the backend will support this in the API:\n        // trim off the trailing year in the period name\n        // english names should all have the year at the end of the string\n        genericPeriodNames.push(name.replace(/\\s+\\d{4}$/, ''))\n\n        return genericPeriodNames\n    }, [])\n}\n","import pick from 'lodash-es/pick'\n\nexport const options = {\n    baseLineLabel: {\n        defaultValue: undefined,\n        requestable: false,\n        savable: true,\n    },\n    baseLineValue: {\n        defaultValue: undefined,\n        requestable: false,\n        savable: true,\n    },\n    // colorSet:\n    cumulativeValues: {\n        defaultValue: false,\n        requestable: false,\n        savable: true,\n    },\n    domainAxisLabel: {\n        defaultValue: undefined,\n        requestable: false,\n        savable: true,\n    },\n    hideEmptyRowItems: {\n        defaultValue: 'NONE',\n        requestable: false,\n        savable: true,\n    },\n    hideLegend: { defaultValue: false, requestable: false, savable: true },\n    noSpaceBetweenColumns: {\n        defaultValue: false,\n        requestable: false,\n        savable: true,\n    },\n    percentStackedValues: {\n        defaultValue: false,\n        requestable: false,\n        savable: true,\n    },\n    rangeAxisDecimals: {\n        defaultValue: undefined,\n        requestable: false,\n        savable: true,\n    },\n    rangeAxisLabel: {\n        defaultValue: undefined,\n        requestable: false,\n        savable: true,\n    },\n    rangeAxisMaxValue: {\n        defaultValue: undefined,\n        requestable: false,\n        savable: true,\n    },\n    rangeAxisMinValue: {\n        defaultValue: undefined,\n        requestable: false,\n        savable: true,\n    },\n    rangeAxisSteps: {\n        defaultValue: undefined,\n        requestable: false,\n        savable: true,\n    },\n    regressionType: { defaultValue: 'NONE', requestable: false, savable: true },\n    showData: { defaultValue: true, requestable: false, savable: true },\n    targetLineLabel: {\n        defaultValue: undefined,\n        requestable: false,\n        savable: true,\n    },\n    targetLineValue: {\n        defaultValue: undefined,\n        requestable: false,\n        savable: true,\n    },\n    aggregationType: {\n        defaultValue: 'DEFAULT',\n        requestable: true,\n        savable: true,\n    },\n    completedOnly: { defaultValue: false, requestable: true, savable: true },\n    hideSubtitle: { defaultValue: false, requestable: false, savable: true },\n    hideTitle: { defaultValue: false, requestable: false, savable: true },\n    sortOrder: { defaultValue: '0', requestable: false, savable: true },\n    subtitle: { defaultValue: undefined, requestable: false, savable: true },\n    title: { defaultValue: undefined, requestable: false, savable: true },\n\n    // only for PT\n    colTotals: { defaultValue: false, requestable: false, savable: true },\n    colSubTotals: { defaultValue: false, requestable: false, savable: true },\n    rowTotals: { defaultValue: false, requestable: false, savable: true },\n    rowSubTotals: { defaultValue: false, requestable: false, savable: true },\n    showDimensionLabels: {\n        defaultValue: false,\n        requestable: false,\n        savable: true,\n    },\n    hideEmptyColumns: {\n        defaultValue: false,\n        requestable: false,\n        savable: true,\n    },\n    hideEmptyRows: { defaultValue: false, requestable: false, savable: true },\n    skipRounding: { defaultValue: false, requestable: true, savable: true },\n    numberType: { defaultValue: 'VALUE', requestable: false, savable: true },\n    showHierarchy: { defaultValue: false, requestable: true, savable: true },\n    legendSet: { defaultValue: undefined, requestable: false, savable: true },\n    legendDisplayStrategy: {\n        defaultValue: 'FIXED',\n        requestable: false,\n        savable: true,\n    },\n    legendDisplayStyle: {\n        defaultValue: 'FILL',\n        requestable: false,\n        savable: true,\n    },\n    displayDensity: {\n        defaultValue: 'NORMAL',\n        requestable: false,\n        savable: true,\n    },\n    fontSize: { defaultValue: 'NORMAL', requestable: false, savable: true },\n    digitGroupSeparator: {\n        defaultValue: 'SPACE',\n        requestable: false,\n        savable: true,\n    },\n    approvalLevel: {\n        defaultValue: undefined,\n        requestable: true,\n        savable: false,\n    },\n\n    // these are stored in the AO under reportingParams\n    reportingPeriod: { defaultValue: false, requestable: false, savable: true },\n    organisationUnit: {\n        defaultValue: false,\n        requestable: false,\n        savable: true,\n    },\n    parentOrganisationUnit: {\n        defaultValue: false,\n        requestable: false,\n        savable: true,\n    },\n    // not exposed in UI\n    grandParentOrganisationUnit: {\n        defaultValue: false,\n        requestable: false,\n        savable: true,\n    },\n    regression: { defaultValue: false, requestable: false, savable: true },\n    cumulative: { defaultValue: false, requestable: false, savable: true },\n    measureCriteria: {\n        defaultValue: undefined,\n        requestable: true,\n        savable: true,\n    },\n    topLimit: { defaultValue: '0', requestable: false, savable: true },\n}\n\nexport const computedOptions = {\n    baseLine: { defaultValue: false, requestable: false, savable: false },\n    targetLine: { defaultValue: false, requestable: false, savable: false },\n    axisRange: { defaultValue: undefined, requestable: false, savable: false },\n    legend: { defaultValue: undefined, requestable: false, savable: false },\n}\n\nexport default options\n\nexport const getOptionsForUi = () => {\n    return Object.entries({ ...options, ...computedOptions }).reduce(\n        (map, [option, props]) => {\n            map[option] = props.defaultValue\n\n            return map\n        },\n        {}\n    )\n}\n\nexport const getOptionsForRequest = () => {\n    return Object.entries(options).filter(\n        entry => entry[1].requestable // entry = [option, props]\n    )\n}\n\nconst isNotDefault = (optionsFromVisualization, prop) => {\n    return Boolean(\n        optionsFromVisualization[prop] &&\n            optionsFromVisualization[prop] !== options[prop].defaultValue\n    )\n}\n\nexport const getOptionsFromVisualization = visualization => {\n    const optionsFromVisualization = {\n        ...getOptionsForUi(),\n        ...pick(visualization, Object.keys(options)),\n    }\n\n    optionsFromVisualization.baseLine =\n        isNotDefault(optionsFromVisualization, 'baseLineLabel') ||\n        isNotDefault(optionsFromVisualization, 'baseLineValue')\n\n    optionsFromVisualization.targetLine =\n        isNotDefault(optionsFromVisualization, 'targetLineLabel') ||\n        isNotDefault(optionsFromVisualization, 'targetLineValue')\n\n    // nested options under reportingParams\n    if (visualization.reportingParams) {\n        optionsFromVisualization.organisationUnit =\n            visualization.reportingParams.organisationUnit\n        optionsFromVisualization.reportingPeriod =\n            visualization.reportingParams.reportingPeriod\n        optionsFromVisualization.parentOrganisationUnit =\n            visualization.reportingParams.parentOrganisationUnit\n        optionsFromVisualization.grandParentOrganisationUnit =\n            visualization.reportingParams.grandParentOrganisationUnit\n    }\n\n    // cast option values from Number for some options\n    ;['baseLineValue', 'targetLineValue', 'sortOrder', 'topLimit'].forEach(\n        option => {\n            if (Object.prototype.hasOwnProperty.call(visualization, option)) {\n                optionsFromVisualization[option] = String(visualization[option])\n            }\n        }\n    )\n\n    return optionsFromVisualization\n}\n","import { getOptionsForRequest } from './options'\n\nexport const getRequestOptions = (visualization, filters) => {\n    const options = getOptionsForRequest().reduce((map, [option, props]) => {\n        // only add parameter if value !== default\n        if (\n            visualization[option] !== undefined &&\n            visualization[option] !== props.defaultValue\n        ) {\n            map[option] = visualization[option]\n        }\n\n        return map\n    }, {})\n\n    // interpretation filter\n    if (filters.relativePeriodDate) {\n        options.relativePeriodDate = filters.relativePeriodDate\n    }\n\n    // global filters\n    // userOrgUnit\n    if (filters.userOrgUnit && filters.userOrgUnit.length) {\n        const ouIds = filters.userOrgUnit.map(\n            ouPath => ouPath.split('/').slice(-1)[0]\n        )\n\n        options.userOrgUnit = ouIds.join(';')\n    }\n\n    return options\n}\n","import { isYearOverYear } from '@dhis2/analytics'\nimport {\n    apiFetchAnalyticsForYearOverYear,\n    apiFetchAnalytics,\n} from '../api/analytics'\nimport { computeGenericPeriodNames } from './analytics'\nimport { getRequestOptions } from './getRequestOptions'\n\nexport const fetchData = async ({\n    visualization,\n    filters,\n    d2,\n    forDashboard,\n}) => {\n    const options = getRequestOptions(visualization, filters)\n\n    const extraOptions = {\n        dashboard: forDashboard,\n    }\n\n    if (isYearOverYear(visualization.type)) {\n        const {\n            responses,\n            yearlySeriesLabels,\n        } = await apiFetchAnalyticsForYearOverYear(d2, visualization, options)\n\n        return {\n            responses,\n            extraOptions: {\n                ...extraOptions,\n                yearlySeries: yearlySeriesLabels,\n                xAxisLabels: computeGenericPeriodNames(responses),\n            },\n        }\n    }\n\n    return {\n        responses: await apiFetchAnalytics(d2, visualization, options),\n        extraOptions,\n    }\n}\n","export default {\n    backdrop: {\n        position: 'fixed',\n        height: '100%',\n        width: '100%',\n        top: 0,\n        left: 0,\n        backgroundColor: 'transparent',\n    },\n}\n","import React, { useEffect, useState, useCallback } from 'react'\nimport { createPortal } from 'react-dom'\nimport PropTypes from 'prop-types'\n\nimport { useDataEngine, useDataQuery } from '@dhis2/app-runtime'\nimport { Popper } from '@dhis2/ui-core'\nimport { VIS_TYPE_PIVOT_TABLE } from '@dhis2/analytics'\n\nimport { apiFetchLegendSets } from './api/legendSets'\nimport { orgUnitLevelsQuery } from './api/organisationUnits'\nimport ContextualMenu from './ContextualMenu'\nimport ChartPlugin from './ChartPlugin'\nimport PivotPlugin from './PivotPlugin'\nimport { fetchData } from './modules/fetchData'\n\nimport styles from './styles/VisualizationPlugin.style.js'\n\nconst LEGEND_DISPLAY_STRATEGY_BY_DATA_ITEM = 'BY_DATA_ITEM'\nconst LEGEND_DISPLAY_STRATEGY_FIXED = 'FIXED'\n\nexport const VisualizationPlugin = ({\n    d2,\n    visualization,\n    filters,\n    forDashboard,\n    onError,\n    onLoadingComplete,\n    onResponsesReceived,\n    onDrill,\n    ...props\n}) => {\n    const engine = useDataEngine()\n    const [fetchResult, setFetchResult] = useState(null)\n    const [contextualMenuRef, setContextualMenuRef] = useState(undefined)\n    const [contextualMenuConfig, setContextualMenuConfig] = useState({})\n\n    const onToggleContextualMenu = (ref, data) => {\n        setContextualMenuRef(ref)\n        setContextualMenuConfig(data)\n    }\n\n    const closeContextualMenu = () => setContextualMenuRef(undefined)\n\n    const onContextualMenuItemClick = args => {\n        closeContextualMenu()\n\n        onDrill(args)\n    }\n\n    const { data: ouLevelsResponse } = useDataQuery(orgUnitLevelsQuery, {\n        onError,\n    })\n    const ouLevels = ouLevelsResponse?.orgUnitLevels.organisationUnitLevels\n\n    const doFetchData = useCallback(async () => {\n        const result = await fetchData({\n            visualization,\n            filters,\n            d2,\n            forDashboard,\n        })\n\n        if (result.responses.length) {\n            onResponsesReceived(result.responses)\n        }\n\n        return result\n    }, [d2, filters, forDashboard, onResponsesReceived, visualization])\n\n    const doFetchLegendSets = useCallback(\n        async legendSetIds => {\n            if (!legendSetIds.length) {\n                return []\n            }\n\n            const response = await apiFetchLegendSets(engine, legendSetIds)\n\n            if (response && response.legendSets) {\n                return response.legendSets.legendSets\n            }\n        },\n        [engine]\n    )\n\n    useEffect(() => {\n        setFetchResult(null)\n\n        const doFetchAll = async () => {\n            const { responses, extraOptions } = await doFetchData(\n                visualization,\n                filters,\n                forDashboard\n            )\n\n            const legendSetIds = []\n\n            switch (visualization.legendDisplayStrategy) {\n                case LEGEND_DISPLAY_STRATEGY_FIXED:\n                    if (visualization.legendSet && visualization.legendSet.id) {\n                        legendSetIds.push(visualization.legendSet.id)\n                    }\n                    break\n                case LEGEND_DISPLAY_STRATEGY_BY_DATA_ITEM: {\n                    // parse responses to extract legendSet ids from metaData\n                    // multiple responses are only for YOY which does not support legends\n                    // safe to use only the 1st\n                    // dx dimensions might not be present, the empty array covers that case\n                    const dxIds = responses[0].metaData.dimensions.dx || []\n\n                    dxIds.forEach(dxId => {\n                        const legendSetId =\n                            responses[0].metaData.items[dxId].legendSet\n\n                        if (legendSetId) {\n                            legendSetIds.push(legendSetId)\n                        }\n                    })\n\n                    break\n                }\n            }\n\n            const legendSets = await doFetchLegendSets(legendSetIds)\n\n            setFetchResult({\n                visualization,\n                legendSets,\n                responses,\n                extraOptions,\n            })\n            onLoadingComplete()\n        }\n\n        doFetchAll().catch(error => {\n            onError(error)\n        })\n\n        /* eslint-disable-next-line react-hooks/exhaustive-deps */\n    }, [visualization, filters, forDashboard])\n\n    if (!fetchResult) {\n        return null\n    }\n\n    const contextualMenuRect =\n        contextualMenuRef &&\n        contextualMenuRef.current &&\n        contextualMenuRef.current.getBoundingClientRect()\n\n    const virtualContextualMenuElement = contextualMenuRect\n        ? { getBoundingClientRect: () => contextualMenuRect }\n        : null\n\n    return (\n        <>\n            {!fetchResult.visualization.type ||\n            fetchResult.visualization.type === VIS_TYPE_PIVOT_TABLE ? (\n                <PivotPlugin\n                    visualization={fetchResult.visualization}\n                    responses={fetchResult.responses}\n                    legendSets={fetchResult.legendSets}\n                    onToggleContextualMenu={\n                        onDrill ? onToggleContextualMenu : undefined\n                    }\n                    {...props}\n                />\n            ) : (\n                <ChartPlugin\n                    visualization={fetchResult.visualization}\n                    responses={fetchResult.responses}\n                    extraOptions={fetchResult.extraOptions}\n                    legendSets={fetchResult.legendSets}\n                    {...props}\n                />\n            )}\n            {contextualMenuRect &&\n                createPortal(\n                    <div onClick={closeContextualMenu} style={styles.backdrop}>\n                        <Popper\n                            reference={virtualContextualMenuElement}\n                            placement=\"right\"\n                        >\n                            <ContextualMenu\n                                config={contextualMenuConfig}\n                                ouLevels={ouLevels}\n                                onClick={onContextualMenuItemClick}\n                            />\n                        </Popper>\n                    </div>,\n                    document.body\n                )}\n        </>\n    )\n}\n\nVisualizationPlugin.defaultProps = {\n    filters: {},\n    forDashboard: false,\n    onError: Function.prototype,\n    onLoadingComplete: Function.prototype,\n    onResponsesReceived: Function.prototype,\n    visualization: {},\n}\nVisualizationPlugin.propTypes = {\n    d2: PropTypes.object.isRequired,\n    visualization: PropTypes.object.isRequired,\n    filters: PropTypes.object,\n    forDashboard: PropTypes.bool,\n    onDrill: PropTypes.func,\n    onError: PropTypes.func,\n    onLoadingComplete: PropTypes.func,\n    onResponsesReceived: PropTypes.func,\n}\n"],"names":["legendSetsQuery","legendSets","resource","params","ids","fields","filter","join","apiFetchLegendSets","dataEngine","query","variables","orgUnitLevelsQuery","orgUnitLevels","paging","orgUnitsQuery","orgUnits","id","userDataViewFallback","apiFetchOrganisationUnit","ArrowUpwardIcon","style","width","height","propTypes","PropTypes","object","ArrowDownwardIcon","ContextualMenu","config","ouLevels","onClick","engine","useDataEngine","ouData","setOuData","useState","undefined","subLevelData","setSubLevelData","lookupLevel","levelId","find","item","level","doFetchOuData","useCallback","ouId","useEffect","doFetch","orgUnit","children","length","levelData","menuItemStyle","display","minWidth","i18n","t","parent","name","ou","orgunit","path","array","func","ChartPlugin","visualization","responses","extraOptions","renderCounter","onChartGenerated","animation","defaultAnimation","canvasRef","useRef","renderVisualization","visualizationConfig","createVisualization","current","isSingleValue","type","getSVGForExport","sourceHeight","sourceWidth","defaultProps","filters","Function","prototype","isRequired","arrayOf","number","PivotPlugin","onToggleContextualMenu","response","peId","apiFetchAnalytics","d2","options","req","analytics","request","fromModel","withParameters","withIncludeNumDen","VIS_TYPE_PIVOT_TABLE","rawResponse","aggregate","get","apiFetchAnalyticsForYearOverYear","yearlySeriesReq","addPeriodDimension","yearlySeries","withSkipData","withSkipMeta","withIncludeMetadataDetails","relativePeriodDate","withRelativePeriodDate","yearlySeriesRes","fetch","requests","yearlySeriesLabels","now","Date","currentDay","getDate","padStart","currentMonth","getMonth","metaData","dimensions","forEach","period","push","items","startDate","Promise","all","then","map","res","computeGenericPeriodNames","xAxisRes","reduce","out","pe","metadata","genericPeriodNames","periodId","replace","baseLineLabel","defaultValue","requestable","savable","baseLineValue","cumulativeValues","domainAxisLabel","hideEmptyRowItems","hideLegend","noSpaceBetweenColumns","percentStackedValues","rangeAxisDecimals","rangeAxisLabel","rangeAxisMaxValue","rangeAxisMinValue","rangeAxisSteps","regressionType","showData","targetLineLabel","targetLineValue","aggregationType","completedOnly","hideSubtitle","hideTitle","sortOrder","subtitle","title","colTotals","colSubTotals","rowTotals","rowSubTotals","showDimensionLabels","hideEmptyColumns","hideEmptyRows","skipRounding","numberType","showHierarchy","legendSet","legendDisplayStrategy","legendDisplayStyle","displayDensity","fontSize","digitGroupSeparator","approvalLevel","reportingPeriod","organisationUnit","parentOrganisationUnit","grandParentOrganisationUnit","regression","cumulative","measureCriteria","topLimit","getOptionsForRequest","Object","entries","entry","getRequestOptions","option","props","userOrgUnit","ouIds","ouPath","split","slice","fetchData","forDashboard","dashboard","isYearOverYear","xAxisLabels","backdrop","position","top","left","backgroundColor","LEGEND_DISPLAY_STRATEGY_BY_DATA_ITEM","LEGEND_DISPLAY_STRATEGY_FIXED","VisualizationPlugin","onError","onLoadingComplete","onResponsesReceived","onDrill","fetchResult","setFetchResult","contextualMenuRef","setContextualMenuRef","contextualMenuConfig","setContextualMenuConfig","ref","data","closeContextualMenu","onContextualMenuItemClick","args","ouLevelsResponse","useDataQuery","organisationUnitLevels","doFetchData","result","doFetchLegendSets","legendSetIds","doFetchAll","dxIds","dx","dxId","legendSetId","catch","error","contextualMenuRect","getBoundingClientRect","virtualContextualMenuElement","createPortal","styles","document","body","bool"],"mappings":"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"}